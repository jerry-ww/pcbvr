<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="description" content="">
	<meta name="author" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Potree Viewer</title>

	<link rel="stylesheet" type="text/css" href="../build/potree/potree.css">
	<link rel="stylesheet" type="text/css" href="../libs/jquery-ui/jquery-ui.min.css">
	<link rel="stylesheet" type="text/css" href="../libs/perfect-scrollbar/css/perfect-scrollbar.css">
	<link rel="stylesheet" type="text/css" href="../libs/openlayers3/ol.css">
	<link rel="stylesheet" type="text/css" href="../libs/spectrum/spectrum.css">
	<link rel="stylesheet" type="text/css" href="../libs/jstree/themes/mixed/style.css">
</head>

<body>
	<script src="../libs/jquery/jquery-3.1.1.min.js"></script>
	<script src="../libs/spectrum/spectrum.js"></script>
	<script src="../libs/perfect-scrollbar/js/perfect-scrollbar.jquery.js"></script>
	<script src="../libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="../libs/three.js/build/three.min.js"></script>
	<script src="../libs/other/BinaryHeap.js"></script>
	<script src="../libs/tween/tween.min.js"></script>
	<script src="../libs/d3/d3.js"></script>
	<script src="../libs/proj4/proj4.js"></script>
	<script src="../libs/openlayers3/ol.js"></script>
	<script src="../libs/i18next/i18next.js"></script>
	<script src="../libs/jstree/jstree.js"></script>
	<script src="../build/potree/potree.js"></script>
	<script src="../libs/plasio/js/laslaz.js"></script>
	
	
	<!-- INCLUDE ADDITIONAL DEPENDENCIES HERE -->	
	<div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; ">
		<div id="potree_render_area"></div>
		<div id="potree_sidebar_container"> </div>
	</div>
	
	<script>
	
		window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));
		
		viewer.setEDLEnabled(true);
		viewer.setFOV(60);
		viewer.setPointBudget(1*1000*1000);
		document.title = "";
		viewer.setEDLEnabled(false);
	//	viewer.setBackground("gradient"); // ["skybox", "gradient", "black", "white"];
		viewer.setBackground("skybox");
		viewer.setDescription(``);
		viewer.loadSettingsFromURL();
		
	
		viewer.loadGUI(() => {
			viewer.setLanguage('en');
			$("#menu_appearance").next().show();
			$("#menu_tools").next().show();
			$("#menu_scene").next().show();
			viewer.toggleSidebar();
		});
		
		
		Potree.loadPointCloud("../pointclouds/lion_takanawa/cloud.js", "pageName", e => {
			let pointcloud = e.pointcloud;
			let material = pointcloud.material;
			viewer.scene.addPointCloud(pointcloud);
			material.pointColorType = Potree.PointColorType.RGB; // any Potree.PointColorType.XXXX 
			material.size = 1;
			material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
			material.shape = Potree.PointShape.SQUARE;
			viewer.fitToScreen();
		});
		
		/*
		var loader = new THREE.OBJLoader();
        loader.load(Potree.resourcePath + "/models/stanford_bunny_reduced.obj", function(loadedMesh){
            var material = new THREE.MeshLambertMaterial({
                color: 0xff0000
            });
            loadedMesh.children.forEach(function(child){
               child.material = material;
                child.geometry.computeFaceNormals();
                child.geometry.computeVertexNormals();

                mesh = loadedMesh;
                mesh.position.set(-1.06, 3.5, -1.48);
				mesh.scale.multiplyScalar(3);
				mesh.rotation.set(Math.PI / 2, Math.PI, 0)
                viewer.scene.scene.add(mesh);
            });
		});
*/

	var scene, camera, renderer;
    var container, controls;


    init();
    animate();

    // FUNCTIONS
    function init()
    {
        // SCENE
        scene = new THREE.Scene();
        // CAMERA
        var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
        var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;
        camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);
        camera.position.set(0,150,400);
        camera.lookAt(scene.position);

        scene.add(camera);

        // RENDERER

	  //  renderer = new THREE.WebGLRenderer( {antialias:true} );
	  renderer = new THREE.WebGLRenderer( {antialias:false} );
        renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);

        container = document.getElementById( 'potree_render_area' );
        container.appendChild( renderer.domElement );

        controls = new Potree.OrbitControls( camera, renderer.domElement );

        // LIGHT
        var light = new THREE.PointLight(0xffffff);
        light.position.set(0,250,0);
        scene.add(light);
        // FLOOR

        var path = Potree.resourcePath+'/textures/skybox4/';
        var directions  = ["px", "nx", "py", "ny", "pz", "nz"];
        var format = ".jpg";
        var skyGeometry = new THREE.SphereGeometry(500, 64, 64);

/*
        var materialArray = [];
        for (var i = 0; i < 6; i++)
            materialArray.push( new THREE.MeshBasicMaterial({
                map: THREE.ImageUtils.loadTexture( path + directions[i] + format ),
			    side: THREE.BackSide
			//	side:THREE.DoubleSide
            }));

        var skyMaterial = new THREE.MeshFaceMaterial( materialArray );*/
		var skyMaterial = 
			new THREE.MeshBasicMaterial({
                map: THREE.ImageUtils.loadTexture( Potree.resourcePath + '/textures/paro/paro_001.jpg' ),
			    side: THREE.BackSide
			//	side:THREE.DoubleSide
			});
        var skyBox = new THREE.Mesh( skyGeometry, skyMaterial );
		skyBox.position.set(0.0, 0.0, 4.0);
        //skyBox.scale.x=-1;也是镜像翻转，与上面的side一个效果
        viewer.scene.scene.add( skyBox );

    }

		function animate()
		{
			requestAnimationFrame( animate );
			render();
			update();
		}

		function update()
		{
			controls.update();
		}

		function render()
		{
			renderer.render( scene, camera );
		}
	

		var loader = new THREE.PLYLoader();
		loader.load( Potree.resourcePath + "/models/stanford_bunny_reduced.ply", (geometry) => {
//		loader.load( Potree.resourcePath + "/models/horse.stl", (geometry) => {
			geometry.computeVertexNormals();
			
			// place three instances of this bunny into the scene
			
			let mesh1;
			{
				let material = new THREE.MeshNormalMaterial();
				mesh1 = new THREE.Mesh( geometry, material );
				mesh1.position.set(-1.06, 3.5, -1.48);
				mesh1.scale.multiplyScalar(3);
				mesh1.rotation.set(Math.PI / 2, Math.PI, 0)
				viewer.scene.scene.add(mesh1);
			}
			
			
			let mesh2;
			{
				let material = new THREE.MeshStandardMaterial( { 
					color: 0x0055ff, 
					shading: THREE.FlatShading,
					metalness: 0.2} );
				mesh2 = new THREE.Mesh( geometry, material );
				mesh2.position.set(0.39, 2.36, 0.22);
				mesh2.scale.multiplyScalar(300);
				mesh2.rotation.set(Math.PI / 2, Math.PI, 0)
				viewer.scene.scene.add(mesh2);
			}
			
			let mesh3;
			{
				let material = new THREE.MeshPhysicalMaterial( {
					color: 0x226666,
					metalness: 0,
					roughness: 0.5,
					clearCoat:  1.0,
					clearCoatRoughness: 1.0,
					reflectivity: 1.0
				} );
				mesh3 = new THREE.Mesh( geometry, material );
				mesh3.position.set(1.8, 0.4,-50);
				mesh3.scale.multiplyScalar(500);
				mesh3.rotation.set(Math.PI / 2, Math.PI, 0)
				viewer.scene.scene.add(mesh3);
			}
		});

		
	</script>
	
	
  </body>
</html>