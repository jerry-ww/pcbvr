<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="description" content="">
	<meta name="author" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Potree Viewer</title>

	<link rel="stylesheet" type="text/css" href="../build/potree/potree.css">
	<link rel="stylesheet" type="text/css" href="../libs/jquery-ui/jquery-ui.min.css">
	<link rel="stylesheet" type="text/css" href="../libs/perfect-scrollbar/css/perfect-scrollbar.css">
	<link rel="stylesheet" type="text/css" href="../libs/openlayers3/ol.css">
	<link rel="stylesheet" type="text/css" href="../libs/spectrum/spectrum.css">
	<link rel="stylesheet" type="text/css" href="../libs/jstree/themes/mixed/style.css">
</head>

<body>
	<script src="../libs/jquery/jquery-3.1.1.min.js"></script>
	<script src="../libs/spectrum/spectrum.js"></script>
	<script src="../libs/perfect-scrollbar/js/perfect-scrollbar.jquery.js"></script>
	<script src="../libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="../libs/three.js/build/three.min.js"></script>
	<script src="../libs/other/BinaryHeap.js"></script>
	<script src="../libs/tween/tween.min.js"></script>
	<script src="../libs/d3/d3.js"></script>
	<script src="../libs/proj4/proj4.js"></script>
	<script src="../libs/openlayers3/ol.js"></script>
	<script src="../libs/i18next/i18next.js"></script>
	<script src="../libs/jstree/jstree.js"></script>
	<script src="../libs/webvr/webvr-polyfill.js"></script>

	<script src="../build/potree/potree.js"></script>

	<script src="../libs/plasio/js/laslaz.js"></script>
	<srcipt src="../libs/plasio/vendor/bluebird.js"></srcipt>
	<!-- INCLUDE ADDITIONAL DEPENDENCIES HERE -->
	<!-- INCLUDE SETTINGS HERE -->

	<div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; ">
		<div id="potree_render_area">
		</div>
		<!-- 路径渲染和暂停开关 -->
		<font size="4" color="yellow" style="display:none" id="animate_control">
			<label style="position: absolute; top: 50px; left: 90%; width: 100px; height: 30px; z-index: 10001">
				<input name="radio1" type="radio" value="1" style="width:18px;height:18px" onclick="resume()"
					checked />漫游</label>
			<label style="position: absolute; top: 100px; left: 90%; width: 100px; height: 30px; z-index: 10002">
				<input name="radio1" type="radio" value="2" style="width:18px;height:18px"
					onclick="pause()" />暂停</label>
		</font>
		<div id="potree_sidebar_container"></div>
	</div>

	<script>

		window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));

		viewer.setEDLEnabled(false);
		viewer.setFOV(60);
		viewer.setPointBudget(1 * 1000 * 1000);
		viewer.loadSettingsFromURL();

		viewer.setDescription("Loading Octree of LAS files");


		viewer.loadGUI(() => {
			viewer.setLanguage('en');
			$("#menu_appearance").next().show();
			//viewer.toggleSidebar();
		});
     
	    //let sceneSG = new Potree.Scene();
		//viewer.setScene(sceneSG);
		// Sigeom
		Potree.loadPointCloud("../pointclouds/4f/cloud.js", "lion", function (e) {

			viewer.scene.addPointCloud(e.pointcloud);
        	
          	e.pointcloud.position.set(-10, -15, -2);
			e.pointcloud.scale.set(1, 1, 1);

			let material = e.pointcloud.material;
			material.size = 1;
			material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
          
            viewer.scene.view.position.set(-2.36,-48.64,-23.90);
			viewer.scene.view.lookAt(-0.500, 0.500, -0.707);

			var exp_json = {
				"type": "Annotation",
				"el": [
					{
						"title": "123",
						"description": "1234",
						"position": [
							0.372676971618247,
							0.015464353335574277,
							4.99124818099119
						],
						"cameraPosition": [
							4.320382959466866,
							-3.3260329594668674,
							8.789500175409849
						],
						"cameraTarget": [
							0.1128499999999999,
							0.8814999999999991,
							2.839149999999999
						]
					},
					{
						"title": "test1",
						"description": "1234",
						"position": [
							-0.0041558257390310605,
							0.022719884110685484,
							2.3893705763213653
						],
						"cameraPosition": [
							-1.772629535423083,
							-7.174511637413584,
							4.375046428590723
						],
						"cameraTarget": [
							0.1128499999999999,
							0.8814999999999991,
							2.8391499999999965
						]
					},
					{
						"title": "test2",
						"description": "1234",
						"position": [
							-0.5157630412225382,
							0.5177095959920113,
							4.546127426037529
						],
						"cameraPosition": [
							-1.772629535423083,
							-7.174511637413584,
							4.375046428590723
						],
						"cameraTarget": [
							0.1128499999999999,
							0.8814999999999991,
							2.8391499999999867
						]
					}
				]
			}

			// 目前使用自定义的exp_json做测试，后期后台发送数据遍历生成annotation对象加入场景中
			for (let i = 0; i < exp_json.el.length; i++) {

				var aAbout1 = new Potree.Annotation({
					position: exp_json.el[i].position,
					title: exp_json.el[i].title,
					cameraPosition: exp_json.el[i].cameraPosition,
					cameraTarget: exp_json.el[i].cameraTarget,
					description: exp_json.el[i].description
				});
				viewer.scene.annotations.add(aAbout1);
			}

			e.pointcloud.position.x += 3;
			e.pointcloud.position.y -= 3;
			e.pointcloud.position.z += 4;

			viewer.fitToScreen();

		});

		function pause() {
			animation.pause();
			//light.disableShadowUpdates = true;
		}

		function resume() {
			animation.resume();
			//light.disableShadowUpdates = false;
		}
	</script>
  
	<div style="position: absolute; z-index: 10000; right: 10px; bottom: 10px;" 
		onclick="viewer.toggleVR()">

		<img src="../resources/icons/vr_button.svg" />

	</div>

</body>

</html>